# 数独アプリ仕様書（Python + Tkinter）

## 1. 目的

Python標準ライブラリのみ（`tkinter`）で動作する、デスクトップ向け数独アプリを実装する。
本ドキュメントは実装前の詳細仕様として、画面構成・操作・データモデル・エラー方針・拡張方針を定義する。

## 2. 対象範囲

- 対象言語: Python 3.10+
- GUIフレームワーク: Tkinter（`tkinter`, `tkinter.ttk`）
- 対応OS: Windows / macOS / Linux（Tkinter標準動作環境）
- 本仕様で扱う機能:
  - 9x9数独盤面表示
  - 数字入力と削除
  - 候補数字（メモ）表示
  - 正誤チェック
  - ゲーム状態表示（経過時間、ミス数、難易度）
  - 新規ゲーム、リセット、保存/読込（JSON）

## 3. 用語定義

- **固定セル**: 問題生成時に最初から配置される数字。ユーザー編集不可。
- **可変セル**: ユーザーが入力可能なセル。
- **メモ**: 1セル内に複数候補を小さく保持する情報。
- **衝突**: 行・列・3x3ブロック内で同一数字が重複する状態。

## 4. ユースケース

1. ユーザーは難易度を選んで新規ゲームを開始する。
2. セルを選択して数字（1〜9）を入力する。
3. 必要に応じてメモモードで候補数字を付与/削除する。
4. チェック機能で誤りを確認する。
5. 完成時にクリア演出とタイム表示を確認する。

## 5. 画面仕様

## 5.1 メインウィンドウ

- タイトル: `Sudoku (Tkinter)`
- 初期サイズ: 900x700（リサイズ可）
- 最小サイズ: 800x620
- UIはウインドウサイズ変更時にレイアウトと盤面が追従するレスポンシブ対応とする

## 5.2 レイアウト

- 上部: ツールバー
  - `新規ゲーム`
  - `リセット`
  - `チェック`
  - `ヒント`
  - 難易度選択（`Easy/Normal/Hard`）
  - `メモモード`トグル
- 中央: 9x9盤面
  - 3x3ブロック境界を太線
  - 通常セル境界を細線
- 右側: 情報パネル
  - 経過時間
  - ミス回数
  - 入力済み数
  - 操作ガイド
- 下部: ステータスバー
  - 現在状態（例: `セル R2C7 を選択中` / `衝突があります`）

## 5.3 見た目（配色・文字）

- 背景: 明るいグレー系（`#F6F7FB`）
- 固定セル文字色: 濃紺（`#1F2A44`）
- 可変セル文字色: 黒（`#111111`）
- 選択セル背景: 薄い青（`#DCEBFF`）
- 同一値ハイライト: 薄い黄（`#FFF4CC`）
- 衝突セル背景: 薄い赤（`#FFD6D6`）
- フォント:
  - 数字: `Segoe UI` 20pt（環境に応じて代替）
  - メモ: 8〜9pt

## 6. 入力仕様

## 6.1 キーボード

- `1〜9`: 数字入力
- `BackSpace` / `Delete`: クリア
- 矢印キー: 選択セル移動
- `M`: メモモード切替
- `Ctrl+N`: 新規ゲーム
- `Ctrl+S`: 保存
- `Ctrl+O`: 読込

## 6.2 マウス

- 左クリック: セル選択
- 数字パッド（任意実装）クリック: 入力

## 6.3 入力制約

- 固定セルには入力不可（操作時にステータス表示）
- 0や英字等は無視
- 可変セルの値は常に `None` または `1..9`

## 7. データモデル仕様

```text
GameState
├── puzzle[9][9]        # 固定問題（0は空）
├── solution[9][9]      # 完成解
├── user_grid[9][9]     # ユーザー入力
├── notes[9][9]         # 各セルの候補集合(set[int])
├── fixed_mask[9][9]    # 固定セル判定(bool)
├── mistakes            # ミス回数
├── elapsed_seconds     # 経過秒数
├── difficulty          # easy / normal / hard
└── started_at          # 開始時刻
```

### 7.1 保存形式

- JSON (`.sudoku.json`)
- 必須キー:
  - `puzzle`, `solution`, `user_grid`, `notes`, `mistakes`, `elapsed_seconds`, `difficulty`
- バリデーション失敗時は読込中止 + エラーダイアログ

## 8. ロジック仕様

## 8.1 衝突判定

- 対象セルの値 `v` について以下をチェック:
  - 同じ行内に `v` が2個以上
  - 同じ列内に `v` が2個以上
  - 同じ3x3ブロック内に `v` が2個以上
- 該当セルを衝突表示

## 8.2 完成判定

- 全セルが `1..9` で埋まっている
- かつ衝突が0
- かつ `user_grid` が `solution` と一致

## 8.3 ヒント機能

- 未入力セルを1つ選び、正解値を埋める
- ヒント使用回数をステータスで表示（任意）

## 9. エラー処理

- 保存失敗: I/Oエラー内容をダイアログ表示
- 読込失敗: 不正データとして中断し、状態を変更しない
- 未対応キー入力: 無視
- 例外ログ: コンソールへ出力（将来logging対応）

## 10. 非機能要件

- 起動時間: 2秒以内（一般PC）
- メモリ使用: 100MB以下を目安
- 依存パッケージ: 追加なし（標準ライブラリのみ）
- 可読性: 型ヒントを利用し、主要関数にdocstring付与

## 11. 実装フェーズ案

1. **フェーズ1（今回）**: モックアップ
   - 画面の骨格、セル描画、選択ハイライトのみ
   - モックアップは `test/` ディレクトリに配置する
   - 生成ソースコードが複数ファイルになる場合は `sudoku_app/` 配下に集約する
2. **フェーズ2**: 入力/移動
   - キーボード操作、固定セル保護
3. **フェーズ3**: 判定ロジック
   - 衝突検出、完成判定
4. **フェーズ4**: 保存/読込、ヒント
5. **フェーズ5**: 見た目改善と微調整

## 12. 受け入れ基準（フェーズ1）

- 単体実行コマンドでGUI起動できること
- 9x9盤面が描画されること
- 3x3境界が視認できること
- クリックで選択セルの見た目が変化すること
- 右側情報パネルと上部ボタン群が表示されること

## 13. 実行方法（フェーズ1成果物）

```bash
python test/sudoku_mockup.py
```
